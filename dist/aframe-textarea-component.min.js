!function(t){function e(n){if(i[n])return i[n].exports;var s=i[n]={exports:{},id:n,loaded:!1};return t[n].call(s.exports,s,s.exports,e),s.loaded=!0,s.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e){if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");AFRAME.registerComponent("textarea",{schema:{cols:{type:"int",default:40},rows:{type:"int",default:20},color:{type:"color",default:"black"},backgroundColor:{type:"color",default:"white"},text:{type:"string",default:""}},init:function(){this.text=null,this.lines=[],this.lastBlink=0,this.blinkEnabled=!0,this.charWidth=this.charHeight=null,this.selectionStart=this.selectionEnd=0,this.endIndexInfo=this.startIndexInfo=null,this.origin={x:0,y:0},this.background=document.createElement("a-plane"),this.background.setAttribute("color",this.data.backgroundColor),this.el.appendChild(this.background),this.textAnchor=document.createElement("a-entity"),this.el.appendChild(this.textAnchor),this.textAnchor.setAttribute("text",{mode:"pre",baseline:"top",anchor:"center",font:"dejavu",wrapCount:this.data.cols,height:this.data.rows,color:this.data.color}),this._initTextarea(),this._initCursor(),this.el.addEventListener("textfontset",this._updateCharMetrics.bind(this)),this.el.addEventListener("char-metrics-changed",this._updateIndexInfo.bind(this)),this.el.addEventListener("char-metrics-changed",this._updateCursorGeometry.bind(this)),this.el.addEventListener("text-changed",this._updateLines.bind(this)),this.el.addEventListener("text-changed",this._updateDisplayText.bind(this)),this.el.addEventListener("selection-changed",this._updateIndexInfo.bind(this)),this.el.addEventListener("selection-changed",this._updateCursorStyle.bind(this)),this.el.addEventListener("selection-changed",this._updateCursorGeometry.bind(this)),this.el.addEventListener("selection-changed",this._updateHorizontalOrigin.bind(this)),this.el.addEventListener("lines-changed",this._updateIndexInfo.bind(this)),this.el.addEventListener("index-info-changed",this._updateOrigin.bind(this)),this.el.addEventListener("index-info-changed",this._updateCursorGeometry.bind(this)),this.el.addEventListener("index-info-changed",this._updateHorizontalOrigin.bind(this)),this.el.addEventListener("origin-changed",this._updateCursorGeometry.bind(this)),this.el.addEventListener("origin-changed",this._updateDisplayText.bind(this)),this.el.addEventListener("click",this.focus.bind(this))},focus:function(){this.textarea.focus()},_initTextarea:function(){this.textarea=document.createElement("textarea"),this.textarea.style.whiteSpace="pre",this.textarea.style.overflow="hidden",this.textarea.cols=this.data.cols,this.textarea.rows=this.data.rows,this.textarea.value=this.data.text,this.textarea.selectionStart=0,this.textarea.selectionEnd=0,document.body.appendChild(this.textarea),this._updateIndexInfo()},_initCursor:function(){this.cursor=document.createElement("a-entity"),this.cursorGeo=new THREE.PlaneGeometry(1,1),this.cursorMat=new THREE.MeshBasicMaterial({color:"black",transparent:!0,opacity:.5}),this.cursorMesh=new THREE.Mesh(this.cursorGeo,this.cursorMat),window.cursorMesh=this.cursorMesh,this.cursor.setObject3D("mesh",this.cursorMesh),this.el.appendChild(this.cursor)},_emit:function(t,e){this.el.emit(t,e)},_updateCharMetrics:function(t){const e=this.textAnchor.components.text.geometry.layout,i=t.detail.fontObj.widthFactor;this.charWidth=i*this.textAnchor.object3DMap.text.scale.x,this.charHeight=this.charWidth*e.lineHeight/i,this.textAnchor.setAttribute("position",{x:0,y:this.charHeight*this.data.rows/2,z:0}),this.background.setAttribute("scale",{x:1.05,y:this.charHeight*this.data.rows*1.05,z:1}),this.background.setAttribute("position",{x:0,y:0,z:0}),this._emit("char-metrics-changed")},_checkAndUpdateSelection:function(){if(this.selectionStart!==this.textarea.selectionStart||this.selectionEnd!==this.textarea.selectionEnd){const t=this.selectionStart,e=this.selectionEnd;this.selectionStart=this.textarea.selectionStart,this.selectionEnd=this.textarea.selectionEnd,this._emit("selection-changed",{start:{old:t,new:this.selectionStart,changed:this.selectionStart!==t},end:{old:e,new:this.selectionEnd,changed:this.selectionEnd!==e}})}},tick:function(t){t-this.lastBlink>500&&this.blinkEnabled&&(this.cursorMesh.visible=!this.cursorMesh.visible,this.lastBlink=t),this._checkAndUpdateSelection(),this._checkAndUpdateText()},_getIndexInfo:function(t,e){const i=Math.max(0,t),n=this.lines[i],s=e-n.start;return{line:n,x:s*this.charWidth,y:-this.charHeight*i+-this.charHeight/2}},_updateIndexInfo:function(){if(this.lines.length){const t=this.startIndexInfo&&this.startIndexInfo.line.index,e=this.endIndexInfo&&this.endIndexInfo.line.index;this.startIndexInfo=null,this.endIndexInfo=null;var i,n=!1,s=!1;for(i=0;i<=this.lines.length;i++){const h=this.lines[i-1],a=i===this.lines.length?h.start+h.length+1:this.lines[i].start;if(a>this.selectionStart&&!this.startIndexInfo&&(this.startIndexInfo=this._getIndexInfo(i-1,this.selectionStart),this.startIndexInfo.line.index!==t&&(n=!0)),a>this.selectionEnd){this.endIndexInfo=this._getIndexInfo(i-1,this.selectionEnd),this.endIndexInfo.line.index!==e&&(s=!0);break}}(n||s)&&this._emit("index-info-changed",{start:{changed:n},end:{changed:s}})}},_updateOrigin:function(t){var e=!1;if(t.detail.end.changed){const i=this.origin.y+this.data.rows-1;this.endIndexInfo.line.index>i?(this.origin.y=this.endIndexInfo.line.index+1-this.data.rows,e=!0):this.endIndexInfo.line.index<this.origin.y&&(this.origin.y=this.endIndexInfo.line.index,e=!0)}t.detail.start.changed&&this.startIndexInfo.line.index<this.origin.y&&(this.origin.y=this.startIndexInfo.line.index,e=!0),e&&this._emit("origin-changed")},_updateHorizontalOrigin:function(t){if(this.endIndexInfo){var e=!0;if(t.detail.end.changed){const i=this.selectionEnd-this.endIndexInfo.line.start;i>this.origin.x+this.data.cols?(this.origin.x=i-this.data.cols,e=!0):i<this.origin.x&&(this.origin.x=i,e=!0)}const n=this.selectionStart-this.startIndexInfo.line.start;t.detail.start.changed&&(n>this.origin.x+this.data.cols?(this.origin.x=n-this.data.cols,e=!0):n<this.origin.x&&(this.origin.x=n,e=!0)),e&&this._emit("origin-changed")}},_updateCursorStyle:function(){this.selectionStart===this.selectionEnd?(this.blinkEnabled=!0,this.cursorMat.color.setStyle("black"),this.cursorMat.transparent=!1):(this.blinkEnabled=!1,this.cursorMat.color.setStyle("white"),this.cursorMesh.visible=!0,this.cursorMat.transparent=!0)},_updateCursorGeometry:function(){if(this.startIndexInfo){this.cursorMesh.geometry=new THREE.Geometry;const t=Math.max(this.origin.y,this.startIndexInfo.line.index),e=Math.min(this.origin.y+this.data.rows-1,this.endIndexInfo.line.index),i=this.origin.x+this.data.cols;for(var n=t;n<=e;n++){const s=new THREE.Mesh(this.cursorGeo,this.cursorMat);var h,a=0;if(e===t){a=Math.max(this.origin.x,this.selectionStart-this.startIndexInfo.line.start);const r=Math.min(i,this.selectionEnd-this.startIndexInfo.line.start);h=Math.max(.2,r-a)}else{var r;n===this.startIndexInfo.line.index?(a=Math.max(this.origin.x,this.selectionStart-this.startIndexInfo.line.start),r=Math.min(i,this.startIndexInfo.line.length)):n===this.endIndexInfo.line.index?(a=this.origin.x,r=Math.min(i,this.selectionEnd-this.endIndexInfo.line.start)):(a=this.origin.x,r=Math.min(i,this.lines[n].length)),h=r-a}s.scale.set(this.charWidth*h,this.charHeight,1),s.position.set(a*this.charWidth+this.charWidth*h/2-.5-this.origin.x*this.charWidth,-n*this.charHeight+this.charHeight*this.data.rows/2-this.charHeight/2+this.origin.y*this.charHeight,.002),this.cursorMesh.geometry.mergeMesh(s)}this.cursorMesh.geometry.verticesNeedUpdate=!0}},_updateLines:function(){this.lines=[];const t=this.text.split("\n");for(var e=0,i=0;i<t.length;i++)this.lines[i]={index:i,length:t[i].length,start:e},e+=t[i].length+1;this._emit("lines-changed")},_getViewportText:function(){return this.text.split("\n").slice(this.origin.y,this.origin.y+this.data.rows).map(function(t){return t.substr(this.origin.x,this.data.cols)||" "}).join("\n")},_updateDisplayText:function(){this.textAnchor.setAttribute("text",{value:this._getViewportText()})},_checkAndUpdateText:function(){const t=this.textarea.value;t!==this.text&&(this.text=t,this._emit("text-changed"))}})}]);